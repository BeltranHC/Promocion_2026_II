// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// ADMIN & AUTH
// ============================================

model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // Hashed with bcrypt
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================
// EVENTS
// ============================================

model Event {
  id          String   @id @default(cuid())
  date        String   // e.g., "15 Mar"
  year        String   // e.g., "2026"
  title       String
  description String   @db.Text
  status      String   @default("upcoming") // "upcoming" | "past"
  icon        String   @default("")
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  
  // Nuevos campos para detalle del evento
  fullDescription String?  @db.Text  // Descripci贸n completa/detallada
  location        String?            // Lugar del evento
  time            String?            // Hora del evento
  ticketPrice     Float?             // Precio de entrada (null = gratis)
  maxTickets      Int?               // M谩ximo de entradas disponibles
  hasTickets      Boolean  @default(false) // Si el evento tiene venta de entradas
  
  // Cronograma del evento (JSON array)
  schedule        String?  @db.Text  // JSON: [{ time: "18:00", activity: "Apertura" }]
  
  // Indicaciones/notas adicionales
  instructions    String?  @db.Text  // Indicaciones para asistentes
  
  // Im谩genes del evento
  images          EventImage[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model EventImage {
  id        String   @id @default(cuid())
  eventId   String
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  url       String   // Cloudinary URL
  publicId  String   // Cloudinary public_id
  caption   String?  // Descripci贸n de la imagen
  order     Int      @default(0)
  createdAt DateTime @default(now())

  @@index([eventId])
}

// ============================================
// GALLERY
// ============================================

model GalleryImage {
  id          String   @id @default(cuid())
  url         String   // Cloudinary URL
  publicId    String   // Cloudinary public_id for deletion
  category    String   // "campus" | "friends" | "events"
  label       String
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ============================================
// PAYMENTS & FUND
// ============================================

model Payment {
  id          String   @id @default(cuid())
  studentId   String
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  amount      Float    @default(5)  // Monto del pago (S/.)
  weekNumber  Int      // N煤mero de semana del aporte
  paidAt      DateTime // Fecha en que pag贸
  notes       String?  // Notas opcionales
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([studentId])
}

model FundSettings {
  id                  String   @id @default("main")
  goal                Float    @default(5000)
  weeklyAmount        Float    @default(5)
  totalMembers        Int      @default(50)
  maxWeeks            Int      @default(17)  // N煤mero m谩ximo de semanas de aportes
  startDate           DateTime @default(now()) // Fecha inicio de aportes
  updatedAt           DateTime @updatedAt
}

// ============================================
// GENERAL SETTINGS
// ============================================

model SiteSettings {
  id              String @id @default("main")
  promotionName   String @default("Promoci贸n 2026 - II")
  schoolName      String @default("EPIEI - UNA Puno")
  contactEmail    String @default("")
  instagramUrl    String @default("")
  facebookUrl     String @default("")
  whatsappNumber  String @default("")
  updatedAt       DateTime @updatedAt
}

// ============================================
// STUDENTS / MEMBERS
// ============================================

model Student {
  id          String    @id @default(cuid())
  name        String    // Nombre completo
  nickname    String?   // Apodo (opcional)
  description String?   @db.Text // Breve descripci贸n
  quote       String?   // Frase caracter铆stica
  photoUrl    String?   // URL de Cloudinary (null = placeholder)
  photoId     String?   // Cloudinary public_id para eliminaci贸n
  order       Int       @default(0)
  isActive    Boolean   @default(true)
  payments    Payment[] // Historial de pagos
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}
